:root { 
    --blue: #2563eb; 
    --fade-blue: rgba(37, 99, 235, 0.2); 
    --red: #e74c3c; 
    --green: #10b981; 
    --purple: #8e44ad; 
    --orange: #f39c12; 
    --bg-base: #121212;
    --bg-panel: #1e1e1e;
    --bg-hover: #2a2a2a;
    --bg-header: #171E26;
    --border-color: #333333;
    --text-main: #e0e0e0;
    --text-muted: #888888;
}

* { box-sizing: border-box; font-family: Calibri, 'Candara', 'Segoe UI', sans-serif; }
body { margin: 0; padding: 0; height: 100vh; width: 100vw; display: flex; background: var(--bg-base); color: var(--text-main); overflow: hidden; }

/* SHIFT-CLICK HIGHLIGHT FIX */
.stop-item, .glide-row, .marker, .glide-table-header {
    user-select: none;
    -webkit-user-select: none;
}

/* VIEW MODES */
body.view-driver { flex-direction: column; }
.view-driver #map-wrapper { height: 35vh; min-height: 35vh; width: 100%; border-bottom: 2px solid var(--border-color); }
.view-driver #sidebar { height: 65vh; min-height: 65vh; width: 100%; }

body.view-admin { flex-direction: row; }
.view-admin #sidebar { width: 480px; height: 100vh; border-right: 2px solid var(--border-color); }
.view-admin #map-wrapper { flex: 1; height: 100vh; }
.view-admin .stop-actions { display: none !important; }
body.view-admin #bulk-complete-btn { display: none !important; }

body.view-map #sidebar { display: none !important; }
body.view-map #map-wrapper { height: 100vh; width: 100vw; }

body.view-list #map-wrapper { display: none !important; }
body.view-list #sidebar { width: 100vw; height: 100vh; max-width: none; border-right: none; }

/* MANAGER VIEW */
body.view-manager { flex-direction: row; }
body.view-manager #map-wrapper { flex: 1; height: 100vh; width: auto; }
body.view-manager #sidebar { width: 50vw; min-width: 10vw; height: 100vh; border-left: none; flex: none; }
body.view-manager #bulk-complete-btn { display: none !important; }
body.view-manager #route-summary { display: none !important; }

/* ROUTING VIEW (New for V198.0) */
body.view-routing { flex-direction: row; }
body.view-routing #map-wrapper { flex: 1; height: 100vh; width: auto; }
body.view-routing #sidebar { width: 400px; height: 100vh; border-right: 2px solid var(--border-color); }
#routing-controls { display: none; padding: 15px; background: var(--bg-panel); border-bottom: 1px solid var(--border-color); }
body.view-routing #routing-controls { display: flex; flex-direction: column; gap: 15px; }

/* SLIDER STYLING */
input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: var(--blue); cursor: pointer; margin-top: -6px; }
input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: var(--border-color); border-radius: 2px; }

/* RESIZER / SLIDER */
#resizer {
    width: 6px;
    background-color: var(--border-color);
    cursor: col-resize;
    display: none;
    flex: none;
    z-index: 100;
    transition: background-color 0.2s;
}
#resizer:hover, #resizer.active { background-color: var(--blue); }
body.view-manager #resizer { display: block; }

#map-wrapper { position: relative; background-color: var(--bg-base); }
#map { position: absolute; top: 0; bottom: 0; width: 100%; height: 100%; }

#map-hint {
    position: absolute; top: 15px; left: 15px;
    background: rgba(0,0,0,0.25); 
    backdrop-filter: blur(4px);
    color: rgba(255,255,255,0.9); padding: 8px 12px;
    border-radius: 6px; font-size: 13px; font-weight: bold;
    z-index: 200; pointer-events: none; border: 1px solid rgba(255,255,255,0.15);
}

.floating-brand {
    position: absolute; top: 15px; right: 15px; z-index: 1000;
    background: var(--bg-header); padding: 8px 16px; border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.5); display: flex; align-items: center; gap: 12px;
    border: 1px solid var(--border-color); pointer-events: none; justify-content: space-between; min-width: 200px;
}
body:not(.view-map) #map-brand { display: none; }

#map-wrapper.shift-down .mapboxgl-canvas-container,
#map-wrapper.shift-down .mapboxgl-canvas-container.mapboxgl-interactive,
#map-wrapper.shift-down .mapboxgl-canvas-container.mapboxgl-interactive:active {
    cursor: crosshair !important;
}
#map-wrapper.shift-down .marker,
#map-wrapper.shift-down .marker .pin-visual {
    cursor: pointer !important;
}

#route-summary { padding: 10px 12px; background: #000; color: #fff; display: flex; justify-content: space-between; align-items: center; font-size: 13px; font-weight: bold; }
.summary-left { display: flex; align-items: center; gap: 12px; }

.btn-reoptimize { 
    background: var(--blue); color: white; border: none; border-radius: 6px; 
    padding: 6px 12px; font-size: 15px; font-weight: normal; cursor: pointer; 
    display: flex; align-items: center; gap: 6px; transition: opacity 0.2s;
}
.btn-reoptimize:active { opacity: 0.7; }

.rocker { display: flex; background: #222; border-radius: 6px; padding: 2px; }
.rocker div { padding: 4px 10px; cursor: pointer; border-radius: 4px; transition: 0.2s; color: var(--text-muted); font-weight: normal; font-size: 15px; }
.rocker div.active { background: var(--blue); color: white; }

.map-overlay-btns { position: absolute; top: 15px; left: 50%; transform: translateX(-50%); z-index: 200; display: flex; flex-direction: column; gap: 8px; align-items: center; }
.floating-btn { background: var(--bg-panel); color: var(--text-main); border: 1px solid var(--border-color); border-radius: 20px; padding: 8px 16px; font-weight: bold; font-size: 13px; cursor: pointer; box-shadow: 0 2px 6px rgba(0,0,0,0.5); display: none; }
#bulk-remove-btn { background: var(--red); color: white; border: none; }
#bulk-complete-btn { background: var(--green); color: white; border: none; }

#sidebar { 
    display: flex; flex-direction: column; background: var(--bg-panel); z-index: 10; 
    container-type: inline-size; 
    container-name: sidebar;
    overflow-x: hidden; 
}

#search-container { padding: 8px; border-bottom: 1px solid var(--border-color); background: var(--bg-panel); }
#search-input { width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; background: var(--bg-base); color: var(--text-main); }
#search-input::placeholder { color: var(--text-muted); }
#stop-list { flex: 1; overflow-y: auto; overflow-x: hidden; -webkit-overflow-scrolling: touch; position: relative; }

@container sidebar (max-width: 700px) { .col-type { display: none !important; } }
@container sidebar (max-width: 600px) { .col-client { display: none !important; } }
@container sidebar (max-width: 500px) { .col-app { display: none !important; } }
@container sidebar (max-width: 450px) { .col-due { display: none !important; } }
@container sidebar (max-width: 380px) { .col-insp { display: none !important; } }

#controls { display: none; padding: 12px; background: var(--bg-base); border-bottom: 1px solid var(--border-color); flex-direction: column; gap: 8px; }
.ctrl-row { display: flex; gap: 8px; width: 100%; }
.btn-glide { 
    flex: 1; display: flex; align-items: center; justify-content: center; gap: 6px;
    padding: 10px; border: none; border-radius: 8px; font-weight: normal; font-size: 13px; 
    cursor: pointer; transition: opacity 0.2s; box-shadow: 0 1px 3px rgba(0,0,0,0.3);
}
.btn-glide:active { opacity: 0.7; }

.stop-item { display: flex; align-items: stretch; border-bottom: 1px solid var(--border-color); background: var(--bg-panel); min-height: 60px; cursor: pointer; position: relative; }
.stop-item.completed { opacity: 0.5; background: var(--bg-base); }
.stop-item.selected { background: var(--fade-blue) !important; }
.stop-item.compact { min-height: 45px; }

.stop-sidebar { width: 35px; background-color: var(--purple); color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 16px; }
.stop-sidebar.due-today { background-color: var(--orange); }
.stop-sidebar.past-due { background-color: var(--red); }

.handle { padding: 0 8px; color: var(--text-muted); cursor: grab; font-size: 18px; display: flex; align-items: center; }
.csv-box { align-self: center; width: 28px; height: 28px; border: 1.5px solid var(--blue); color: var(--blue); display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 10px; border-radius: 4px; margin: 0 8px; }

.stop-content { flex: 1; padding: 5px 0; overflow: hidden; display: flex; flex-direction: column; justify-content: center; }
.stop-content b { font-size: 15px; color: var(--text-main); line-height: 1.1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

.compact .row-meta, .compact .row-details { display: none; }
.row-meta { font-size: 12px; color: var(--text-muted); }
.row-details { font-size: 11px; color: #666; }

.due-date-container { display: flex; align-items: center; padding: 0 10px; font-weight: bold; font-size: 18px; color: var(--text-main); margin-left: auto; }
.due-date-container.due-today { color: var(--orange); }
.due-date-container.past-due { color: var(--red); }

.stop-actions { display: flex; align-items: center; padding-right: 8px; gap: 4px; }
.icon-btn { font-size: 28px; cursor: pointer; padding: 4px; }

.glide-table-header { display: flex; padding: 10px 8px; font-weight: bold; border-bottom: 1px solid var(--border-color); color: var(--text-muted); font-size: 12px; text-transform: uppercase; background: var(--bg-header); position: sticky; top: 0; z-index: 5; }
.glide-row { display: flex; padding: 10px 8px; border-bottom: 1px solid #282828; font-size: 14px; color: var(--text-main); align-items: center; cursor: pointer; background: var(--bg-panel); transition: background 0.2s; }
.glide-row:hover { background: var(--bg-hover); }
.glide-row.selected { background: var(--fade-blue) !important; }
.glide-row.completed { opacity: 0.5; }

.sortable { cursor: pointer; transition: color 0.2s; display: flex; align-items: center; }
.sortable:hover { color: var(--text-main); }

.col-num { width: 36px; color: var(--text-muted); font-size: 12px; flex-shrink: 0; display: flex; align-items: center; }

.num-badge { 
    width: 26px; height: 26px; border-radius: 4px; 
    display: flex; align-items: center; justify-content: center;
    font-weight: bold; font-size: 13px;
}
.glide-row.completed .num-badge { background-color: #555 !important; color: white !important; }

.col-due { width: 65px; display: flex; align-items: center; justify-content: center; gap: 2px; font-weight: 500; flex-shrink: 0;}
.col-due.due-today { color: var(--orange); }
.col-due.past-due { color: var(--red); font-weight: bold; }

.col-insp { width: 120px; color: var(--text-muted); padding-right: 6px; flex-shrink: 0; }

.col-addr { flex: 1 1 auto; min-width: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-right: 6px; font-weight: 500; }
.col-app { width: 45px; color: var(--text-muted); flex-shrink: 0; display: flex; align-items: center; justify-content: center; }
.col-client { width: 110px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-right: 6px; flex-shrink: 0; }
.col-type { width: 100px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--text-muted); flex-shrink: 0;}

.insp-select { 
    width: 100%; background-color: var(--bg-panel); color: var(--text-main); 
    border: 1px solid var(--border-color); padding: 6px 20px 6px 6px; border-radius: 4px; 
    font-size: 13px; cursor: pointer; -webkit-appearance: none; -moz-appearance: none; appearance: none;
    background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23888888%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
    background-repeat: no-repeat; background-position: right 6px center; background-size: 10px auto;
}
.insp-select:focus { outline: none; border-color: var(--blue); }
.insp-select option { background: var(--bg-panel); color: var(--text-main); }
.insp-select:disabled { opacity: 0.6; cursor: not-allowed; }

.marker { 
    position: absolute !important; width: 28px; height: 28px; 
    display: flex; align-items: center; justify-content: center; 
    cursor: pointer; border-radius: 50%; z-index: 1;
}
.marker.bulk-selected { z-index: 1000 !important; }

.pin-visual {
    width: 100%; height: 100%; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 12px; font-weight: bold; color: white;
    border: 2px solid var(--bg-panel);
    transition: transform 0.1s, box-shadow 0.1s, background-color 0.2s;
}

.marker.bulk-selected .pin-visual { 
    background-color: #ffffff !important; color: #000000 !important; 
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.8); transform: scale(1.15); border-color: #ffffff !important;
}
.marker.completed .pin-visual { background-color: #555 !important; color: white !important; }
.marker-warning { position: absolute; top: -10px; right: -10px; font-size: 16px; pointer-events: none; z-index: 5; }

.boxdraw {
    background: rgba(37, 99, 235, 0.3); border: 1px solid var(--blue);
    position: absolute; top: 0; left: 0; width: 0; height: 0; pointer-events: none; z-index: 999;
}

#modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center; }
.modal-box { background: var(--bg-panel); color: var(--text-main); padding: 20px; border-radius: 8px; width: 90%; max-width: 350px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); border: 1px solid var(--border-color); }
.modal-box input { background: var(--bg-base); color: var(--text-main); border: 1px solid var(--border-color); }

#processing-overlay {
    display: flex; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; 
    background: rgba(0,0,0,0.8); z-index: 9999; align-items: center; justify-content: center; 
    color: white; font-size: 22px; font-weight: bold; letter-spacing: 1px;
}
